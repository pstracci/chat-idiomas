// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  nickname  String    @db.VarChar(10)
  email     String    @unique
  password  String?   // Mantido como opcional para logins sociais

  // Seus campos de login social e consentimento (MANTIDOS)
  googleId   String?   @unique
  facebookId String?   @unique
  emailConsent Boolean @default(false)

  // Seus campos de recuperação de senha (MANTIDOS)
  passwordResetToken   String?   @unique
  passwordResetExpires DateTime?

  // Novos campos de status de sessão
  isOnline  Boolean   @default(false)
  lastSeen  DateTime  @default(now())
  
  // Relação com o perfil
  profile   Profile?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

// NOVO MODELO para os dados do perfil do usuário
model Profile {
  id                String    @id @default(uuid())
  userId            String    @unique
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Campos movidos de User para Profile
  firstName         String?
  lastName          String?
  dateOfBirth       DateTime? // Substitui o antigo campo 'age'

  // Novos campos de perfil
  phone             String?
  country           String?
  profilePicture    String?   // Armazenará a imagem em Base64

  languagesSpoken   Json      @default("[]") 
  languagesLearning String[]  @default([])

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

// Seu modelo de sessão (MANTIDO EXATAMENTE COMO VOCÊ ENVIOU)
model Session {
  sid    String   @id
  sess   Json
  expire DateTime

  @@map("session")
}